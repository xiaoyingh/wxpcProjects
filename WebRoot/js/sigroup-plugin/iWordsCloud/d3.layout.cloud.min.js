!function(a){function b(){function C(b,c,d){for(var n,o,p,f=([{x:0,y:0},{x:a[0],y:a[1]}],c.x),g=c.y,h=Math.sqrt(a[0]*a[0]+a[1]*a[1]),i=u(a),k=Math.random()<.5?1:-1,m=-k;(n=i(m+=k))&&(o=~~n[0],p=~~n[1],!(Math.min(o,p)>h));)if(c.x=f+o,c.y=g+p,!(c.x+c.x0<0||c.y+c.y0<0||c.x+c.x1>a[0]||c.y+c.y1>a[1]||d&&j(c,b,a[0])||d&&!l(c,d))){for(var z,q=c.sprite,r=c.width>>5,s=a[0]>>5,t=c.x-(r<<4),v=127&t,w=32-v,x=c.y1-c.y0,y=(c.y+c.y0)*s+(t>>5),A=0;x>A;A++){z=0;for(var B=0;r>=B;B++)b[y+B]|=z<<w|(r>B?(z=q[A*r+B])>>>v:0);y+=s}return delete c.sprite,!0}return!1}var a=[256,256],b=c,n=d,p=f,q=e,r=e,s=g,t=h,u=m,v=[],x=1/0,y=d3.dispatch("word","end"),z=null,A=null,B={};return B.start=function(){function j(){for(var j,b=+new Date;+new Date-b<x&&++f<e&&z;)j=h[f],j.x=a[0]*(Math.random()+.5)>>1,j.y=a[1]*(Math.random()+.5)>>1,i(j,h,f),j.hasText&&C(c,j,d)&&(g.push(j),y.word(j),d?k(d,j):d=[{x:j.x+j.x0,y:j.y+j.y0},{x:j.x+j.x1,y:j.y+j.y1}],j.x-=a[0]>>1,j.y-=a[1]>>1);f>=e&&(B.stop(),y.end(g,d,A))}var c=o((a[0]>>5)*a[1]),d=null,e=v.length,f=-1,g=[],h=v.map(function(a,c){return a.text=b.call(this,a,c),a.font=n.call(this,a,c),a.style=q.call(this,a,c),a.weight=r.call(this,a,c),a.rotate=s.call(this,a,c),a.size=~~p.call(this,a,c),a.padding=t.call(this,a,c),a}).sort(function(a,b){return b.size-a.size});return z&&clearInterval(z),z=setInterval(j,0),j(),B},B.stop=function(){return z&&(clearInterval(z),z=null),B},B.timeInterval=function(a){return arguments.length?(x=null==a?1/0:a,B):x},B.words=function(a){return arguments.length?(v=a,B):v},B.size=function(b){return arguments.length?(a=[+b[0],+b[1]],B):a},B.font=function(a){return arguments.length?(n=d3.functor(a),B):n},B.fontStyle=function(a){return arguments.length?(q=d3.functor(a),B):q},B.fontWeight=function(a){return arguments.length?(r=d3.functor(a),B):r},B.rotate=function(a){return arguments.length?(s=d3.functor(a),B):s},B.text=function(a){return arguments.length?(b=d3.functor(a),B):b},B.spiral=function(a){return arguments.length?(u=w[a+""]||a,B):u},B.fontSize=function(a){return arguments.length?(p=d3.functor(a),B):p},B.padding=function(a){return arguments.length?(t=d3.functor(a),B):t},B.iwc=function(a){return arguments.length?(A=a,B):null},d3.rebind(B,y,"on")}function c(a){return a.text}function d(){return"serif"}function e(){return"normal"}function f(a){return Math.sqrt(a.value)}function g(){return 30*(~~(6*Math.random())-3)}function h(){return 1}function i(a,b,c){if(!a.sprite){v.clearRect(0,0,(q<<5)/t,r/t);var d=0,e=0,f=0,g=b.length;for(--c;++c<g;){a=b[c],v.save(),v.font=a.style+" "+a.weight+" "+~~((a.size+1)/t)+"px "+a.font;var h=v.measureText(a.text+"m").width*t,i=a.size<<1;if(a.rotate){var j=Math.sin(a.rotate*p),k=Math.cos(a.rotate*p),l=h*k,m=h*j,n=i*k,o=i*j;h=Math.max(Math.abs(l+o),Math.abs(l-o))+31>>5<<5,i=~~Math.max(Math.abs(m+n),Math.abs(m-n))}else h=h+31>>5<<5;if(i>f&&(f=i),d+h>=q<<5&&(d=0,e+=f,f=0),e+i>=r)break;v.translate((d+(h>>1))/t,(e+(i>>1))/t),a.rotate&&v.rotate(a.rotate*p),v.fillText(a.text,0,0),a.padding&&(v.lineWidth=2*a.padding,v.strokeText(a.text,0,0)),v.restore(),a.width=h,a.height=i,a.xoff=d,a.yoff=e,a.x1=h>>1,a.y1=i>>1,a.x0=-a.x1,a.y0=-a.y1,a.hasText=!0,d+=h}for(var s=v.getImageData(0,0,(q<<5)/t,r/t).data,u=[];--c>=0;)if(a=b[c],a.hasText){for(var h=a.width,w=h>>5,i=a.y1-a.y0,x=0;i*w>x;x++)u[x]=0;if(d=a.xoff,null==d)return;e=a.yoff;for(var y=0,z=-1,A=0;i>A;A++){for(var x=0;h>x;x++){var B=w*A+(x>>5),C=s[(e+A)*(q<<5)+(d+x)<<2]?1<<31-x%32:0;u[B]|=C,y|=C}y?z=A:(a.y0++,i--,A--,e++)}a.y1=a.y0+z,a.sprite=u.slice(0,(a.y1-a.y0)*w)}}}function j(a,b,c){c>>=5;for(var k,d=a.sprite,e=a.width>>5,f=a.x-(e<<4),g=127&f,h=32-g,i=a.y1-a.y0,j=(a.y+a.y0)*c+(f>>5),l=0;i>l;l++){k=0;for(var m=0;e>=m;m++)if((k<<h|(e>m?(k=d[l*e+m])>>>g:0))&b[j+m])return!0;j+=c}return!1}function k(a,b){var c=a[0],d=a[1];b.x+b.x0<c.x&&(c.x=b.x+b.x0),b.y+b.y0<c.y&&(c.y=b.y+b.y0),b.x+b.x1>d.x&&(d.x=b.x+b.x1),b.y+b.y1>d.y&&(d.y=b.y+b.y1)}function l(a,b){return a.x+a.x1>b[0].x&&a.x+a.x0<b[1].x&&a.y+a.y1>b[0].y&&a.y+a.y0<b[1].y}function m(a){var b=a[0]/a[1];return function(a){return[b*(a*=.1)*Math.cos(a),a*Math.sin(a)]}}function n(a){var b=4,c=b*a[0]/a[1],d=0,e=0;return function(a){var f=0>a?-1:1;switch(3&Math.sqrt(1+4*f*a)-f){case 0:d+=c;break;case 1:e+=b;break;case 2:d-=c;break;default:e-=b}return[d,e]}}function o(a){for(var b=[],c=-1;++c<a;)b[c]=0;return b}var s,p=Math.PI/180,q=64,r=2048,t=1;if("undefined"!=typeof document)s=document.createElement("canvas"),s.width=1,s.height=1,t=Math.sqrt(s.getContext("2d").getImageData(0,0,1,1).data.length>>2),s.width=(q<<5)/t,s.height=r/t;else{var u=require("canvas");s=new u(q<<5,r)}var v=s.getContext("2d"),w={archimedean:m,rectangular:n};v.fillStyle=v.strokeStyle="red",v.textAlign="center",a.cloud=b}("undefined"==typeof exports?d3.layout||(d3.layout={}):exports);